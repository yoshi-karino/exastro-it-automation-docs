
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <title>Organization (オーガナイゼーション) &#8212; Documentation  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/option.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/translations.js"></script>
  
    <script type="text/javascript" src="../../../_static/exastro_documents.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="検索" href="../../../search.html" /> 
  </head>
<body id="page" class="ja">


<div id="container">

<div id="header">
  <header class="divInner">
    <!-- Exastro logo -->
    <div id="logo"><img src="../../../_static/img/exastro.svg" alt="Exastro"></div>
    <!-- Project name -->
    <div id="projectName"><a href="../../../index.html">Documentation</a></div>
    <!-- Heaedr navigation -->
    <div id="headerSearch">
      <form class="search" action="../../../search.html" method="get">
        <input type="text" name="q" aria-labelledby="searchlabel">
        <button type="submit" value="検索"><img src="../../../_static/img/search.png" alt="検索"></button>
      </form>
    </div>
  </header>
</div><!-- End #header -->


<div id="toolbar">
  <div class="divInner">
    
    <div id="documentVersion">
      <dl>
        <dt>Document version</dt>
        <dd>
          <div>
            <select name="version" onchange="location.href=value;">
                file_path: v2.0/ja/platform/organization
                  <option value="#"
                  selected
                  >current</option>
                file_path: v2.0/ja/platform/organization
                  <option value="#"
                  selected
                  >v2.0 (current)</option>
            </select>
          </div>
        </dd>
      </dl>
    </div>

    <div id="documentLanguage">
      <dl>
        <dt>Language</dt>
        <dd>
          <div>
            <select name="lang" onchange="location.href=value;">
                file_path: v2.0/ja/platform/organization
                hasdoc: True
                  <option value="#"
                  selected
                  >日本語</option>
                file_path: v2.0/en/platform/organization
                hasdoc: False
            </select>
          </div>
        </dd>
      </dl>
    </div>
    <div id="toolbarNavigation">
      <ul>
      </ul>
    </div>
  </div>
</div><!-- End #toolbar -->

<div id="sideMenu">

  <div id="menuButton"></div>
  
  <aside class="divInner">
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Exastro IT Automation Documentation</a></li>
</ul>

    <!-- <ul>
      <li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">索引</a></li>
    </ul> -->
    
  </aside>
</div><!-- End #sideMenu -->

<div id="contents">
<main class="divInner">


<div id="breadcrumbs">
  <ul>
    <li><a href="../../../index.html">HOME</a></li>
    
    <li>Organization (オーガナイゼーション)</li>
  </ul>
</div>


<div id="article">
<article class="divInner">
<div class="body" role="main">

  <section id="organization">
<h1>Organization (オーガナイゼーション)<a class="headerlink" href="#organization" title="この見出しへのパーマリンク">¶</a></h1>
<section id="id1">
<h2>はじめに<a class="headerlink" href="#id1" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本章では、Exastro Suite における Organization (オーガナイゼーション) について説明します。</div>
</div>
</section>
<section id="id2">
<h2>オーガナイゼーションとは<a class="headerlink" href="#id2" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">Exastro IT Automation 2.0 から導入されたマルチテナント機能におけるテナントの単位のことで、論理的に組織の空間を区分する単位のことを指します。</div>
<div class="line">Exastro Suite の各アプリケーションの利用を開始するためには、オーガナイゼーションを作成する必要があります。</div>
</div>
</section>
<section id="id3">
<h2>オーガナイゼーションの作成<a class="headerlink" href="#id3" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">オーガナイゼーション作成を行うことで、オーガナイゼーション管理者のアカウントが作成され、オーガナイゼーションごとのエンドポイントURLにアクセスすることができるようになります。</div>
<div class="line">また、システム内部では下記の処理が実行されます。</div>
</div>
<ul class="simple">
<li><p>Keycloak に、オーガナイゼーション用のレルムデータと管理者ユーザが登録されます。</p></li>
<li><p>MariaDB や MySQL といったリレーショナルデータベースに、オーガナイゼーション用のデータが登録されます。</p></li>
<li><p>Exastro IT Automation の永続ボリュームに、オーガナイゼーション用のディレクトリが作成されます。</p></li>
<li><p>GitLab に、オーガナイゼーション用のユーザが登録されます。</p></li>
</ul>
<section id="id4">
<h3>前提条件<a class="headerlink" href="#id4" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">本作業には下記のコマンドが必要となるため、事前にインストールをしてください。</div>
</div>
<ul class="simple">
<li><p>作業クライアントに必要なアプリケーション</p>
<ul>
<li><p><kbd class="kbd docutils literal notranslate">curl</kbd></p></li>
<li><p><kbd class="kbd docutils literal notranslate">git</kbd></p></li>
<li><p><kbd class="kbd docutils literal notranslate">jq</kbd></p></li>
</ul>
</li>
</ul>
</section>
<section id="id5">
<h3>オーガナイゼーション作成<a class="headerlink" href="#id5" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">オーガナイゼーションの作成方法には、下記の3通りの方法があります。</div>
</div>
<ul class="simple">
<li><p><a class="reference internal" href="#org-create-method-1"><span class="std std-ref">方法1: 設定ファイルを使った作成方法</span></a></p></li>
<li><p><a class="reference internal" href="#org-create-method-2"><span class="std std-ref">方法2: 対話型による作成方法</span></a></p></li>
<li><p><a class="reference internal" href="#org-create-method-3"><span class="std std-ref">方法3: Rest API による作成方法</span></a></p></li>
</ul>
<section id="org-create-method-1">
<span id="id6"></span><h4>方法1: 設定ファイルを使った作成方法<a class="headerlink" href="#org-create-method-1" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">GitHub リポジトリから取得した資材の中にある、シェルスクリプトを実行しオーガナイゼーションを作成します。</div>
</div>
<ol class="arabic">
<li><p>オーガナイゼーション作成用シェルスクリプトを、リポジトリから <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">git</kbd> <kbd class="kbd docutils literal notranslate">clone</kbd></kbd> により取得します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exastro Platform の資材を入手</span>
git clone https://github.com/exastro-suite/exastro-platform.git
</pre></div>
</div>
</li>
<li><p>設定ファイルの <kbd class="kbd docutils literal notranslate">CONF_BASE_URL</kbd> に Exastro Suite の管理用エンドポイント URL を設定します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exastro Platform への接続のための設定情報を登録</span>
vi ./exastro-platform/test/tools/create-organization.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">例えば、<a class="reference internal" href="../installation/installation_kubernetes.html#ingress-setting"><span class="std std-ref">サービス公開の設定 (Ingress の設定)</span></a> をした場合は下記のようになります。</div>
</div>
<ul>
<li><p>create-organization.conf</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">- CONF_BASE_URL=http://platform-auth:8001</span><span class="w"></span>
<span class="gi">+ CONF_BASE_URL=http://exastro-suite-mng.xxxxxxxxxxxxxxxxxx.japaneast.aksapp.io</span><span class="w"></span>
<span class="w"> </span> CURL_OPT=-sv<span class="w"></span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">自己証明書を利用している場合、証明書エラーが発生します。</div>
<div class="line">設定ファイル内の <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">CURL_OPT=</kbd>-<kbd class="kbd docutils literal notranslate">sv</kbd></kbd> を <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">CURL_OPT=</kbd>-<kbd class="kbd docutils literal notranslate">svk</kbd></kbd> に変更することで証明書エラーを回避できますが、認証機関から発行された正しい証明書をインストールすることを推奨します。</div>
</div>
</div>
</li>
<li><p>オーガナイゼーション情報の設定</p>
<div class="line-block">
<div class="line">オーガナイゼーション作成時の初期登録情報として下記の項目を設定できます。</div>
</div>
<table class="docutils align-left" id="id11">
<caption><span class="caption-text">オーガナイゼーション作成パラメータ</span><a class="headerlink" href="#id11" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 27.8%" />
<col style="width: 33.3%" />
<col style="width: 38.9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>項目の内容</p></th>
<th class="head"><p>形式</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>オーガナイゼーションID</p></td>
<td><div class="line-block">
<div class="line">英小文字、数字、ハイフン、アンダースコア。</div>
<div class="line">最大36文字。</div>
<div class="line">※先頭文字は英小文字であること。</div>
<div class="line">※予約語(後述)に合致しないこと。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>name</p></td>
<td><p>オーガナイゼーション名</p></td>
<td><p>最大255文字</p></td>
</tr>
<tr class="row-even"><td><p>organization_managers</p></td>
<td><p>オーガナイゼーション管理者の情報</p></td>
<td><p>※複数名登録するときは繰り返し指定可能</p></td>
</tr>
<tr class="row-odd"><td><p>organization_managers[*].username</p></td>
<td><p>オーガナイゼーション管理者のユーザ名（ログインするときのID）</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>organization_managers[*].email</p></td>
<td><p>オーガナイゼーション管理者のE-mailアドレス</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>organization_managers[*].firstName</p></td>
<td><p>オーガナイゼーション管理者の名</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>organization_managers[*].lastName</p></td>
<td><p>オーガナイゼーション管理者の姓</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>organization_managers[*].credentials[0].value</p></td>
<td><p>オーガナイゼーション管理者の初期パスワード</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>options.sslRequired</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">external</strong> (既定): プライベート IP アドレスに固定する限り、ユーザは SSL 無しで Keycloak と通信可能。</div>
<div class="line"><strong class="program">none</strong>: SSL の設定なし。</div>
<div class="line"><strong class="program">all</strong>: すべての IP アドレスに対し、SSL を要求。(内部の API が HTTP アクセスのため選択不可)</div>
</div>
</td>
<td></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">設定ファイルの作成は、<code class="file docutils literal notranslate"><span class="pre">./exastro-platform/test/tools/create-organization.sample.json</span></code> を基に、作成するオーガナイゼーションの情報を指定した JSON ファイルを基に作成します。</div>
</div>
<details>
  <summary>create-organization.sample.json</summary><div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="w">    </span><span class="p">:</span><span class="w">   </span><span class="s2">&quot;org002&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="w">  </span><span class="p">:</span><span class="w">   </span><span class="s2">&quot;org002-name&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;organization_managers&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;username&quot;</span><span class="w">  </span><span class="p">:</span><span class="w">   </span><span class="s2">&quot;admin&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;email&quot;</span><span class="w">     </span><span class="p">:</span><span class="w">   </span><span class="s2">&quot;admin@example.com&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;firstName&quot;</span><span class="w"> </span><span class="p">:</span><span class="w">   </span><span class="s2">&quot;admin&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;lastName&quot;</span><span class="w">  </span><span class="p">:</span><span class="w">   </span><span class="s2">&quot;admin&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;credentials&quot;</span><span class="w">   </span><span class="p">:</span><span class="w">   </span><span class="p">[</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="w">      </span><span class="p">:</span><span class="w">   </span><span class="s2">&quot;password&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="nt">&quot;value&quot;</span><span class="w">     </span><span class="p">:</span><span class="w">   </span><span class="s2">&quot;password&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="nt">&quot;temporary&quot;</span><span class="w"> </span><span class="p">:</span><span class="w">   </span><span class="kc">true</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;requiredActions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">                </span><span class="s2">&quot;UPDATE_PROFILE&quot;</span><span class="w"></span>
<span class="w">            </span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;options&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</details><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> exastro-platform/test/tools/

cp -pi ./exastro-platform/test/tools/create-organization<span class="o">{</span>.sample,<span class="o">}</span>.json

vi ./exastro-platform/test/tools/create-organization.json
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">optionsの値に <strong class="program">&quot;sslRequired&quot;: &quot;none&quot;</strong> を指定することで、オーガナイゼーションユーザが http でのアクセスが可能となります。</div>
</div>
</div>
</li>
<li><p>オーガナイゼーション作成実行</p>
<p>Platform管理者アカウントを登録していない場合は、<a class="reference external" href="http://10.197.17.190:30400/631aac9174a18b0047bb938c">Platform管理者アカウントの追加</a></p>
<ul>
<li><p>コマンド</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./exastro-platform/test/tools/create-organization.sh create-organization.json

your username : INPUT-YOUR-USERNAME <span class="c1"># Platform管理者のユーザ名を入力します</span>
your password : INPUT-USER-PASSWORD <span class="c1"># Platform管理者のパスワードを入力します</span>

Create an organization, are you sure? <span class="o">(</span>Y/other<span class="o">)</span> : Y <span class="c1"># Y を入力するとオーガナイゼーションの作成処理が開始します</span>
</pre></div>
</div>
</li>
<li><p>成功時の結果表示
resultが”000-00000”が、オーガナイゼーションの作成に成功したことを示しています。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>...
&lt; HTTP/1.1 <span class="m">200</span> OK
&lt; Date: Thu, <span class="m">18</span> Aug <span class="m">2022</span> <span class="m">01</span>:49:13 GMT
&lt; Server: Apache/2.4.37 <span class="o">(</span>Red Hat Enterprise Linux<span class="o">)</span> mod_wsgi/4.7.1 Python/3.9
&lt; Content-Length: <span class="m">107</span>
&lt; Content-Type: application/json
&lt;
<span class="o">{</span>
  <span class="s2">&quot;data&quot;</span>: null,
  <span class="s2">&quot;message&quot;</span>: <span class="s2">&quot;SUCCESS&quot;</span>,
  <span class="s2">&quot;result&quot;</span>: <span class="s2">&quot;000-00000&quot;</span>,
  <span class="s2">&quot;ts&quot;</span>: <span class="s2">&quot;2022-08-18T01:49:17.251Z&quot;</span>
<span class="o">}</span>
* Connection <span class="c1">#0 to host platform-auth left intact</span>
</pre></div>
</div>
</li>
<li><p>失敗時の結果表示イメージ</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>...
&lt; HTTP/1.1 <span class="m">400</span> BAD REQUEST
&lt; Date: Thu, <span class="m">18</span> Aug <span class="m">2022</span> <span class="m">05</span>:29:35 GMT
&lt; Server: Apache/2.4.37 <span class="o">(</span>Red Hat Enterprise Linux<span class="o">)</span> mod_wsgi/4.7.1 Python/3.9
&lt; Content-Length: <span class="m">252</span>
&lt; Connection: close
&lt; Content-Type: application/json
&lt;
<span class="o">{</span> <span class="o">[</span><span class="m">252</span> bytes data<span class="o">]</span>
* Closing connection <span class="m">0</span>
<span class="o">{</span>
  <span class="s2">&quot;data&quot;</span>: null,
  <span class="s2">&quot;message&quot;</span>: <span class="s2">&quot;指定されたorganization(org002)は作成済みのため、作成できません。&quot;</span>,
  <span class="s2">&quot;result&quot;</span>: <span class="s2">&quot;400-23001&quot;</span>,
  <span class="s2">&quot;ts&quot;</span>: <span class="s2">&quot;2022-08-18T05:29:35.643Z&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</section>
<section id="org-create-method-2">
<span id="id7"></span><h4>方法2: 対話型による作成方法<a class="headerlink" href="#org-create-method-2" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">画面の指示に従ってオーガナイゼーション情報を指定し、オーガナイゼーションを作成します</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">この方法の場合、オーガナイゼーション管理者は1人のみ指定できます。</div>
<div class="line">複数名オーガナイゼーション管理者を作成する場合は、<a class="reference internal" href="#org-create-method-1"><span class="std std-ref">設定ファイルを使った作成手順</span></a> で行ってください。</div>
</div>
</div>
<div class="line-block">
<div class="line">GitHub リポジトリから取得した資材の中にある、シェルスクリプトを実行しオーガナイゼーションを作成します。</div>
</div>
<ol class="arabic">
<li><p>オーガナイゼーション作成用シェルスクリプトを、リポジトリから <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">git</kbd> <kbd class="kbd docutils literal notranslate">clone</kbd></kbd> しダウンロードします。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exastro Platform の資材を入手</span>
git clone https://github.com/exastro-suite/exastro-platform.git
</pre></div>
</div>
</li>
<li><p>設定ファイルの <kbd class="kbd docutils literal notranslate">CONF_BASE_URL</kbd> に Exastro Suite の管理用エンドポイント URL を設定します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># クローンしたディレクトリに移動</span>
<span class="nb">cd</span> exastro-platform/test/tools/

<span class="c1"># 接続先の</span>
vi ./exastro-platform/test/tools/create-organization.conf

<span class="nv">CONF_BASE_URL</span><span class="o">={</span>Exastro Suite の管理用エンドポイント URL<span class="o">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例えば、<a class="reference internal" href="../installation/installation_kubernetes.html#ingress-setting"><span class="std std-ref">サービス公開の設定 (Ingress の設定)</span></a> をした場合は下記のようになります。</div>
</div>
<ul>
<li><p>create-organization.conf</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">- CONF_BASE_URL=http://platform-auth:8001</span><span class="w"></span>
<span class="gi">+ CONF_BASE_URL=http://exastro-suite-mng.xxxxxxxxxxxxxxxxxx.japaneast.aksapp.io</span><span class="w"></span>
<span class="w"> </span> CURL_OPT=-sv<span class="w"></span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">自己証明書を利用している場合、証明書エラーが発生します。</div>
<div class="line">設定ファイル内の <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">CURL_OPT=</kbd>-<kbd class="kbd docutils literal notranslate">sv</kbd></kbd> を <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">CURL_OPT=</kbd>-<kbd class="kbd docutils literal notranslate">svk</kbd></kbd> に変更することで証明書エラーを回避できますが、認証機関から発行された正しい証明書をインストールすることを推奨します。</div>
</div>
</div>
</li>
<li><p>オーガナイゼーション作成実行</p>
<div class="line-block">
<div class="line">オーガナイゼーション作成時の初期登録情報として下記の項目を設定できます。</div>
</div>
<table class="docutils align-left" id="id12">
<caption><span class="caption-text">オーガナイゼーション作成パラメータ</span><a class="headerlink" href="#id12" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 40.0%" />
<col style="width: 26.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>項目の内容</p></th>
<th class="head"><p>形式</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>organization id</p></td>
<td><p>オーガナイゼーションID</p></td>
<td><div class="line-block">
<div class="line">英小文字、数字、ハイフン、アンダースコア</div>
<div class="line">最大36文字</div>
<div class="line">※先頭文字は英小文字であること</div>
<div class="line">※予約語(後述)に合致しないこと</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>organization name</p></td>
<td><p>オーガナイゼーション名</p></td>
<td><p>最大255文字</p></td>
</tr>
<tr class="row-even"><td><p>organization manager's username</p></td>
<td><p>オーガナイゼーション管理者のユーザ名（ログインするときのID）</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>organization manager's email</p></td>
<td><p>オーガナイゼーション管理者のE-mailアドレス</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>organization manager's firstname</p></td>
<td><p>オーガナイゼーション管理者の名</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>organization manager's lastname</p></td>
<td><p>オーガナイゼーション管理者の姓</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>organization manager's initial password</p></td>
<td><p>オーガナイゼーション管理者の初期パスワード</p></td>
<td></td>
</tr>
</tbody>
</table>
</li>
</ol>
<ul>
<li><p>コマンド</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash ./exastro-platform/test/tools/create-organization.sh
</pre></div>
</div>
</li>
<li><p>コマンド実行後に入力 (入力例)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Please enter the organization information to be created

organization id : org001 # オーガナイゼーションIDを入力します
organization name : organization001 # オーガナイゼーション名を入力します
organization manager&#39;s username : org-manager # オーガナイゼーション管理者のユーザ名（ログインするときのID）を入力します
organization manager&#39;s email : # オーガナイゼーション管理者のE-mailアドレスを入力します
organization manager&#39;s first name : # オーガナイゼーション管理者の名を入力します
organization manager&#39;s last name : # オーガナイゼーション管理者の姓を入力します
organization manager&#39;s initial password : # オーガナイゼーション管理者の初期パスワードを入力します

your username : INPUT-YOUR-USERNAME # Platform管理者のユーザ名を入力します
your password : INPUT-USER-PASSWORD # Platform管理者のパスワードを入力します

Create an organization, are you sure? (Y/other) : Y # &quot;Y&quot;を入力すると実行します
</pre></div>
</div>
</li>
<li><p>成功時の結果表示
resultが”000-00000”が、オーガナイゼーションの作成に成功したことを示しています。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>...
&lt; HTTP/1.1 <span class="m">200</span> OK
&lt; Date: Thu, <span class="m">18</span> Aug <span class="m">2022</span> <span class="m">01</span>:49:13 GMT
&lt; Server: Apache/2.4.37 <span class="o">(</span>Red Hat Enterprise Linux<span class="o">)</span> mod_wsgi/4.7.1 Python/3.9
&lt; Content-Length: <span class="m">107</span>
&lt; Content-Type: application/json
&lt;
<span class="o">{</span>
   <span class="s2">&quot;data&quot;</span>: null,
   <span class="s2">&quot;message&quot;</span>: <span class="s2">&quot;SUCCESS&quot;</span>,
   <span class="s2">&quot;result&quot;</span>: <span class="s2">&quot;000-00000&quot;</span>,
   <span class="s2">&quot;ts&quot;</span>: <span class="s2">&quot;2022-08-18T01:49:17.251Z&quot;</span>
<span class="o">}</span>
* Connection <span class="c1">#0 to host platform-auth left intact</span>
</pre></div>
</div>
</li>
<li><p>失敗時の結果表示イメージ</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>...
&lt; HTTP/1.1 <span class="m">400</span> BAD REQUEST
&lt; Date: Thu, <span class="m">18</span> Aug <span class="m">2022</span> <span class="m">05</span>:29:35 GMT
&lt; Server: Apache/2.4.37 <span class="o">(</span>Red Hat Enterprise Linux<span class="o">)</span> mod_wsgi/4.7.1 Python/3.9
&lt; Content-Length: <span class="m">252</span>
&lt; Connection: close
&lt; Content-Type: application/json
&lt;
<span class="o">{</span> <span class="o">[</span><span class="m">252</span> bytes data<span class="o">]</span>
* Closing connection <span class="m">0</span>
<span class="o">{</span>
   <span class="s2">&quot;data&quot;</span>: null,
   <span class="s2">&quot;message&quot;</span>: <span class="s2">&quot;指定されたorganization(org002)は作成済みのため、作成できません。&quot;</span>,
   <span class="s2">&quot;result&quot;</span>: <span class="s2">&quot;400-23001&quot;</span>,
   <span class="s2">&quot;ts&quot;</span>: <span class="s2">&quot;2022-08-18T05:29:35.643Z&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="rest-api">
<span id="org-create-method-3"></span><h4>方法3: Rest API による作成方法<a class="headerlink" href="#rest-api" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">Rest API を使ってオーガナイゼーションを作成します。</div>
</div>
<table class="docutils align-left" id="id13">
<caption><span class="caption-text">オーガナイゼーション作成パラメータ</span><a class="headerlink" href="#id13" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 29.4%" />
<col style="width: 47.1%" />
<col style="width: 23.5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>項目の内容</p></th>
<th class="head"><p>形式</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>オーガナイゼーションID</p></td>
<td><div class="line-block">
<div class="line">英小文字、数字、ハイフン、アンダースコア。</div>
<div class="line">最大36文字。</div>
<div class="line">※先頭文字は英小文字であること。</div>
<div class="line">※予約語(後述)に合致しないこと。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>name</p></td>
<td><p>オーガナイゼーション名</p></td>
<td><p>最大255文字</p></td>
</tr>
<tr class="row-even"><td><p>organization_managers</p></td>
<td><p>オーガナイゼーション管理者の情報</p></td>
<td><p>※複数名登録するときは繰り返し指定可能</p></td>
</tr>
<tr class="row-odd"><td><p>organization_managers[*].username</p></td>
<td><p>オーガナイゼーション管理者のユーザ名（ログインするときのID）</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>organization_managers[*].email</p></td>
<td><p>オーガナイゼーション管理者のE-mailアドレス</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>organization_managers[*].firstName</p></td>
<td><p>オーガナイゼーション管理者の名</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>organization_managers[*].lastName</p></td>
<td><p>オーガナイゼーション管理者の姓</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>organization_managers[*].credentials[0].value</p></td>
<td><p>オーガナイゼーション管理者の初期パスワード</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>options.sslRequired</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">external</strong> (既定): プライベートIPアドレスに固定する限り、ユーザはSSL無しでKeycloakと通信可能。</div>
<div class="line"><strong class="program">none</strong>: SSLの設定なし。</div>
<div class="line"><strong class="program">all</strong>: すべてのIPアドレスに対し、SSLを要求。(内部のAPIがHTTPアクセスのため選択不可)</div>
</div>
</td>
<td></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">シェルスクリプトを介さずに、APIを直接実行する場合は、以下の様なコマンドを実行してください。</div>
<div class="line">BASIC 認証を行うために、Exastro Platform 管理者の認証情報を <kbd class="kbd docutils literal notranslate">BASE64_BASIC</kbd> に設定する必要があります。</div>
<div class="line">認証情報に関して、<a class="reference internal" href="../installation/installation_kubernetes.html#database-setup"><span class="std std-ref">インストール時に登録した認証情報</span></a> で登録した内容となります。</div>
</div>
<div class="line-block">
<div class="line">また、Exastro Platform の管理用 URL 情報を <kbd class="kbd docutils literal notranslate">BASE_URL</kbd> に設定する必要があります。</div>
<div class="line">例えば、<a class="reference internal" href="../installation/installation_kubernetes.html#ingress-setting"><span class="std std-ref">サービス公開の設定 (Ingress の設定)</span></a> をした場合は下記のようになります。</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">BASE64_BASIC</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -n <span class="s2">&quot;KEYCLOAK_USER:KEYCLOAK_PASSWORD&quot;</span> <span class="p">|</span> base64<span class="k">)</span>
<span class="nv">BASE_URL</span><span class="o">=</span>http://exastro-suite-mng.xxxxxxxxxxxxxxxxxx.japaneast.aksapp.io

curl -k -X POST <span class="se">\</span>
    -H <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="se">\</span>
    -H <span class="s2">&quot;Authorization: basic </span><span class="si">${</span><span class="nv">BASE64_BASIC</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
    -d  @- <span class="se">\</span>
    <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASE_URL</span><span class="si">}</span><span class="s2">/api/platform/organizations?retry=1&quot;</span> <span class="se">\</span>
    <span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">  &quot;id&quot;: &quot;org002&quot;,</span>
<span class="s">  &quot;name&quot;: &quot;org002-name&quot;,</span>
<span class="s">  &quot;organization_managers&quot;: [</span>
<span class="s">    {</span>
<span class="s">      &quot;username&quot;: &quot;admin&quot;,</span>
<span class="s">      &quot;email&quot;: &quot;admin@example.com&quot;,</span>
<span class="s">      &quot;firstName&quot;: &quot;admin&quot;,</span>
<span class="s">      &quot;lastName&quot;: &quot;admin&quot;,</span>
<span class="s">      &quot;credentials&quot;: [</span>
<span class="s">        {</span>
<span class="s">          &quot;type&quot;: &quot;password&quot;,</span>
<span class="s">          &quot;value&quot;: &quot;password&quot;,</span>
<span class="s">          &quot;temporary&quot;: true</span>
<span class="s">        }</span>
<span class="s">      ],</span>
<span class="s">      &quot;requiredActions&quot;: [</span>
<span class="s">        &quot;UPDATE_PROFILE&quot;</span>
<span class="s">      ],</span>
<span class="s">      &quot;enabled&quot;: true</span>
<span class="s">    }</span>
<span class="s">  ],</span>
<span class="s">  &quot;options&quot;: {}</span>
<span class="s">}</span>
<span class="s">EOF</span>
</pre></div>
</div>
</section>
</section>
<section id="id8">
<h3>オーガナイゼーションへのアクセス<a class="headerlink" href="#id8" title="この見出しへのパーマリンク">¶</a></h3>
<ol class="arabic">
<li><p>オーガナイゼーション用サイトが表示できるかWebブラウザから確認します。</p>
<div class="line-block">
<div class="line">http[s]://{Exastro Platform の管理用 URL}/{オーガナイゼーションID}/platform/</div>
<div class="line">例: <a class="reference external" href="http://exastro-suite-mng.xxxxxxxxxxxxxxxxxx.japaneast.aksapp.io/org002/platform/">http://exastro-suite-mng.xxxxxxxxxxxxxxxxxx.japaneast.aksapp.io/org002/platform/</a></div>
</div>
</li>
</ol>
</section>
<section id="id9">
<h3>その他制約事項・備考<a class="headerlink" href="#id9" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id">
<h4>オーガナイゼーションIDの予約語<a class="headerlink" href="#id" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">以下に示すパターンに合致するワードは、オーガナイゼーションの ID として使用できません。</div>
</div>
<ul class="simple">
<li><p>master</p></li>
<li><p>platform</p></li>
<li><p>account</p></li>
<li><p>account-console</p></li>
<li><p>admin-cli</p></li>
<li><p>broker</p></li>
<li><p>realm-management</p></li>
<li><p>security-admin-console</p></li>
<li><p>*-workspaces</p></li>
<li><p>system-*-auth</p></li>
</ul>
</section>
<section id="id10">
<h4>オーガナイゼーション作成を再実行する場合<a class="headerlink" href="#id10" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">オーガナイゼーション作成で失敗した場合、オーガナイゼーション作成の再実行をしても「指定されたorganization(xxx)は作成済みのため、作成できません。」というエラーが表示されることがあります。</div>
<div class="line">このように、失敗したオーガナイゼーション ID でオーガナイゼーションの作成ができない場合は、コマンドパラメータに <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">-</kbd>-<kbd class="kbd docutils literal notranslate">retry</kbd></kbd> オプションを付与して実行することで再作成をすることが可能です。</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./exastro-platform/test/tools/create-organization.sh --retry
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./exastro-platform/test/tools/create-organization.sh ./exastro-platform/test/tools/create-organization.sample.json
</pre></div>
</div>
</section>
</section>
</section>
</section>


</div>


<div id="articleNavigation">
  <ul>
  </ul>
</div>


<div id="pageTopLink">
  <a href="#container"><i>↑</i> Page Top</a>
</div>

</article>
</div>
</main>
</div><!-- End #contents -->
<div id="footer">
  <footer class="divInner">
    <small>Copyright © 2022 NEC Corporation</small>
  </footer>
</div><!-- End #footer -->

<div id="overlay"></div>

</div><!-- End #container -->
  </body>
</html>